<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Skinthesis - Real Map Discovery</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />

    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""
    />
    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
      crossorigin=""
    ></script>

    <style>
      /* --- SYSTEM VARS --- */
      :root {
        --primary: #7000ff;
        --accent-pink: #ff0055;
        --text-dark: #2d3436;
        --glass: rgba(255, 255, 255, 0.95);
        --shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
      }

      body {
        font-family: "Outfit", sans-serif;
        margin: 0;
        padding: 0;
        height: 100vh;
        overflow: hidden;
        display: flex;
        flex-direction: column;
      }

      #app-root {
        position: relative;
        width: 100%;
        height: 100%;
      }

      /* --- 1. REAL MAP CONTAINER --- */
      #map {
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0;
        left: 0;
        z-index: 1;
      }

      /* --- 2. CUSTOM MARKER STYLES (ƒê√® l√™n Leaflet) --- */
      /* X√≥a style m·∫∑c ƒë·ªãnh c·ªßa Leaflet divIcon */
      .leaflet-div-icon {
        background: transparent;
        border: none;
      }

      /* User Location Radar */
      .user-radar-marker {
        position: relative;
        width: 20px;
        height: 20px;
      }
      .user-dot {
        width: 20px;
        height: 20px;
        background: #4285f4;
        border: 3px solid white;
        border-radius: 50%;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        position: relative;
        z-index: 2;
      }
      .user-pulse {
        position: absolute;
        top: 50%;
        left: 50%;
        width: 60px;
        height: 60px;
        background: rgba(66, 133, 244, 0.4);
        border-radius: 50%;
        transform: translate(-50%, -50%);
        animation: pulseRadar 2s infinite;
        z-index: 1;
      }
      @keyframes pulseRadar {
        0% {
          transform: translate(-50%, -50%) scale(0.5);
          opacity: 1;
        }
        100% {
          transform: translate(-50%, -50%) scale(2.5);
          opacity: 0;
        }
      }

      /* Spa Pins */
      .custom-pin-marker {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-end;
        transition: 0.3s;
      }
      /* Hi·ªáu ·ª©ng nh·∫£y l√™n khi active */
      .custom-pin-marker.active-pin {
        transform: scale(1.2) translateY(-10px) !important;
        z-index: 1000 !important;
      }

      .pin-bubble {
        background: white;
        padding: 4px 8px;
        border-radius: 8px;
        font-size: 12px;
        font-weight: 700;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        margin-bottom: 2px;
        white-space: nowrap;
      }
      .pin-shape {
        width: 36px;
        height: 36px;
        background: var(--primary);
        border: 3px solid white;
        border-radius: 50% 50% 0 50%;
        transform: rotate(-45deg); /* Xoay ƒë·ªÉ t·∫°o h√¨nh gi·ªçt n∆∞·ªõc */
        display: flex;
        justify-content: center;
        align-items: center;
        box-shadow: 0 5px 10px rgba(0, 0, 0, 0.3);
      }
      .pin-shape i {
        transform: rotate(45deg);
        color: white;
        font-size: 14px;
      }

      /* M√†u khi Active */
      .custom-pin-marker.active-pin .pin-shape {
        background: var(--accent-pink);
      }

      /* --- 3. FLOATING UI (Search & Filters) --- */
      .top-layer {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        z-index: 500; /* Cao h∆°n Leaflet */
        padding: 40px 20px 10px 20px;
        pointer-events: none; /* ƒê·ªÉ b·∫•m xuy√™n qua v√†o map ·ªü nh·ªØng ch·ªó tr·ªëng */
      }
      .pointer-auto {
        pointer-events: auto;
      } /* Cho ph√©p b·∫•m v√†o thanh search */

      .search-bar {
        background: white;
        border-radius: 16px;
        padding: 12px 16px;
        display: flex;
        align-items: center;
        gap: 12px;
        box-shadow: var(--shadow);
        margin-bottom: 12px;
      }
      .search-bar input {
        border: none;
        width: 100%;
        outline: none;
        font-size: 0.95rem;
      }

      .filter-scroll {
        display: flex;
        gap: 8px;
        overflow-x: auto;
        padding-bottom: 5px;
        scrollbar-width: none;
      }
      .chip {
        background: white;
        padding: 6px 14px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 600;
        color: #555;
        white-space: nowrap;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }
      .chip.active {
        background: var(--text-dark);
        color: white;
      }

      /* --- 4. BOTTOM SHEET --- */
      .bottom-sheet {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        background: white;
        border-radius: 24px 24px 0 0;
        padding: 20px;
        z-index: 500;
        box-shadow: 0 -5px 30px rgba(0, 0, 0, 0.2);
        max-height: 45vh;
        overflow-y: auto;
      }
      .sheet-handle {
        width: 40px;
        height: 4px;
        background: #eee;
        border-radius: 10px;
        margin: 0 auto 20px auto;
      }

      .spa-card {
        display: flex;
        gap: 12px;
        padding: 12px;
        border-radius: 12px;
        cursor: pointer;
        transition: 0.2s;
        border: 1px solid transparent;
      }
      .spa-card.active-card {
        background: #f3f0ff;
        border-color: #e0d4ff;
      } /* Highlight trong list */

      .spa-img {
        width: 80px;
        height: 80px;
        border-radius: 12px;
        object-fit: cover;
      }
      .spa-info {
        flex: 1;
        display: flex;
        flex-direction: column;
        justify-content: center;
      }
      .spa-name {
        font-weight: 700;
        font-size: 1rem;
        margin-bottom: 4px;
      }
      .spa-meta {
        font-size: 0.8rem;
        color: #666;
        margin-bottom: 6px;
      }
      .spa-rating {
        color: #ffc107;
        font-weight: 700;
      }
      .btn-book {
        align-self: center;
        background: #eae6ff;
        color: var(--primary);
        border: none;
        padding: 8px 16px;
        border-radius: 12px;
        font-size: 0.8rem;
        font-weight: 700;
      }
    </style>
  </head>
  <body>
    <div id="app-root">
      <div id="map"></div>

      <div class="top-layer">
        <div class="search-bar pointer-auto">
          <i
            class="fa-solid fa-arrow-left text-muted"
            onclick="window.location.href='home.html'"
          ></i>
          <input type="text" placeholder="T√¨m Spa, Clinic..." />
          <i class="fa-solid fa-magnifying-glass text-primary"></i>
        </div>

        <div class="filter-scroll pointer-auto">
          <div class="chip active">
            <i class="fa-solid fa-location-dot me-1"></i> G·∫ßn t√¥i
          </div>
          <div class="chip">Tr·ªã m·ª•n</div>
          <div class="chip">‚≠ê 4.5+</div>
          <div class="chip">üî• Khuy·∫øn m√£i</div>
        </div>
      </div>

      <div class="bottom-sheet">
        <div class="sheet-handle"></div>
        <h6 class="fw-bold mb-3 ps-1">K·∫øt qu·∫£ quanh H√† N·ªôi</h6>

        <div class="d-flex flex-column gap-3">
          <div class="spa-card" id="card-0" onclick="focusOnMap(0)">
            <img
              src="https://i.pinimg.com/736x/88/ad/7f/88ad7feede3e70230ffdc2fb19c7e930.jpg"
              class="spa-img"
            />
            <div class="spa-info">
              <div class="spa-name">Seoul Spa</div>
              <div class="spa-meta">
                <span class="spa-rating">‚òÖ 4.9</span> ‚Ä¢ 0.5 km ‚Ä¢ $$
              </div>
            </div>
            <button class="btn-book">ƒê·∫∑t</button>
          </div>

          <div class="spa-card" id="card-1" onclick="focusOnMap(1)">
            <img
              src="https://i.pinimg.com/736x/35/dc/c2/35dcc2825b1ad5a0a838a9e4529ebb14.jpg"
              class="spa-img"
            />
            <div class="spa-info">
              <div class="spa-name">Lavender By Chang</div>
              <div class="spa-meta">
                <span class="spa-rating">‚òÖ 4.8</span> ‚Ä¢ 1.2 km ‚Ä¢ $$$
              </div>
            </div>
            <button class="btn-book">ƒê·∫∑t</button>
          </div>

          <div class="spa-card" id="card-2" onclick="focusOnMap(2)">
            <img
              src="https://i.pinimg.com/1200x/ea/48/b3/ea48b31a824e713f4909f79282c967a1.jpg"
              class="spa-img"
            />
            <div class="spa-info">
              <div class="spa-name">Thu C√∫c Clinics</div>
              <div class="spa-meta">
                <span class="spa-rating">‚òÖ 4.5</span> ‚Ä¢ 2.5 km ‚Ä¢ $$
              </div>
            </div>
            <button class="btn-book">ƒê·∫∑t</button>
          </div>
        </div>
      </div>
    </div>

    <script>
      // 1. D·ªØ li·ªáu Spa m·∫´u (T·ªça ƒë·ªô quanh H√† N·ªôi)
      const userLoc = [21.0285, 105.8542]; // Ho√†n Ki·∫øm, H√† N·ªôi
      const spas = [
        {
          id: 0,
          name: "Seoul Spa",
          lat: 21.0305,
          lng: 105.8502,
          icon: "fa-spa",
        },
        {
          id: 1,
          name: "Lavender",
          lat: 21.0255,
          lng: 105.8582,
          icon: "fa-star",
        },
        { id: 2, name: "Thu C√∫c", lat: 21.0335, lng: 105.8592, icon: "fa-gem" },
      ];

      // 2. Kh·ªüi t·∫°o b·∫£n ƒë·ªì Leaflet
      const map = L.map("map", { zoomControl: false }).setView(userLoc, 14);

      // Add Tile Layer (Giao di·ªán b·∫£n ƒë·ªì) - D√πng CartoDB Voyager cho ƒë·∫πp & hi·ªán ƒë·∫°i
      L.tileLayer(
        "https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png",
        {
          attribution: "¬© OpenStreetMap",
          maxZoom: 19,
        }
      ).addTo(map);

      // 3. Th√™m User Location Marker (Radar)
      const userIcon = L.divIcon({
        className: "user-radar-marker",
        html: '<div class="user-pulse"></div><div class="user-dot"></div>',
        iconSize: [20, 20],
        iconAnchor: [10, 10],
      });
      L.marker(userLoc, { icon: userIcon }).addTo(map);

      // 4. Th√™m c√°c Spa Pins
      const markers = []; // L∆∞u tr·ªØ ƒë·ªÉ x·ª≠ l√Ω sau

      spas.forEach((spa, index) => {
        // HTML cho Pin t√πy ch·ªânh
        const pinHtml = `
                <div class="pin-bubble">${spa.name}</div>
                <div class="pin-shape"><i class="fa-solid ${spa.icon}"></i></div>
            `;

        const customIcon = L.divIcon({
          className: `custom-pin-marker pin-${index}`,
          html: pinHtml,
          iconSize: [50, 60],
          iconAnchor: [25, 60], // Neo v√†o ƒë√°y c·ªßa gi·ªçt n∆∞·ªõc
        });

        const marker = L.marker([spa.lat, spa.lng], { icon: customIcon }).addTo(
          map
        );

        // S·ª± ki·ªán Click v√†o Pin
        marker.on("click", () => {
          highlightSpa(index);
        });

        markers.push(marker);
      });

      // 5. Logic T∆∞∆°ng t√°c 2 chi·ªÅu (Map <-> List)

      // Khi b·∫•m v√†o Card b√™n d∆∞·ªõi -> Map bay ƒë·∫øn ƒë√≥
      function focusOnMap(index) {
        const spa = spas[index];
        // Bay ƒë·∫øn v·ªã tr√≠
        map.flyTo([spa.lat, spa.lng], 16, { duration: 1.5 });
        highlightSpa(index);
      }

      // H√†m highlight chung
      function highlightSpa(index) {
        // A. X·ª≠ l√Ω Marker tr√™n b·∫£n ƒë·ªì
        // Reset t·∫•t c·∫£ pin
        document
          .querySelectorAll(".custom-pin-marker")
          .forEach((el) => el.classList.remove("active-pin"));
        // Active pin hi·ªán t·∫°i (thao t√°c DOM tr·ª±c ti·∫øp l√™n class c·ªßa Leaflet icon)
        const activePin = document.querySelector(`.pin-${index}`);
        if (activePin) activePin.classList.add("active-pin");

        // B. X·ª≠ l√Ω Card trong danh s√°ch
        document
          .querySelectorAll(".spa-card")
          .forEach((c) => c.classList.remove("active-card"));
        const card = document.getElementById(`card-${index}`);
        if (card) {
          card.classList.add("active-card");
          card.scrollIntoView({ behavior: "smooth", block: "center" });
        }
      }
    </script>
  </body>
</html>
